generator client {
  provider     = "prisma-client"
  output       = "../generated"
  moduleFormat = "esm"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Quiz {
  id          String     @id @default(cuid()) @map("_id")
  title       String
  description String?
  category    String?
  difficulty  String? // "easy"|"medium"|"hard"
  timeLimit   Int? // seconds
  published   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  questions   Question[]
  attempts    Attempt[]

  @@map("quiz")
}

model Question {
  id          String   @id @default(cuid()) @map("_id")
  quizId      String
  quiz        Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  text        String
  explanation String?
  position    Int? // ordering within quiz
  createdAt   DateTime @default(now())
  options     Option[]

  @@map("question")
}

model Option {
  id         String   @id @default(cuid()) @map("_id")
  questionId String
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  text       String
  isCorrect  Boolean  @default(false)

  @@map("option")
}

model Attempt {
  id          String       @id @default(cuid()) @map("_id")
  quizId      String
  userId      String
  score       Int
  total       Int
  startedAt   DateTime     @default(now())
  completedAt DateTime?
  duration    Int? // seconds
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  quiz        Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)
  answers     UserAnswer[]

  @@map("attempt")
}

model UserAnswer {
  id         String  @id @default(cuid()) @map("_id")
  attemptId  String
  questionId String
  optionId   String?
  attempt    Attempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)

  @@map("user_answer")
}

model UserStats {
  userId String @id
  xp     Int    @default(0)
  streak Int    @default(0)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_stats")
}
